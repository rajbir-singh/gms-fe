(function (global, factory) {
    typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, require('@angular/core')) :
    typeof define === 'function' && define.amd ? define('angular-web-storage', ['exports', '@angular/core'], factory) :
    (factory((global['angular-web-storage'] = {}),global.ng.core));
}(this, (function (exports,i0) { 'use strict';

    var StorageUtil = /** @class */ (function () {
        function StorageUtil() {
        }
        StorageUtil.get = function (storage, key) {
            var value = StorageUtil.parse(storage.getItem(key) || 'null') || null;
            if (value === null)
                return null;
            if (typeof value === 'object' &&
                typeof value._expired !== 'undefined' &&
                value._expired !== 0 &&
                +new Date() > value._expired) {
                StorageUtil.remove(storage, key);
                return null;
            }
            return value._value || null;
        };
        StorageUtil.set = function (storage, key, value, expiredAt, expiredUnit) {
            if (expiredAt === void 0) {
                expiredAt = 0;
            }
            if (expiredUnit === void 0) {
                expiredUnit = 't';
            }
            storage.setItem(key, StorageUtil.stringify({
                _expired: StorageUtil.getExpired(expiredAt, expiredUnit),
                _value: value,
            }));
        };
        StorageUtil.remove = function (storage, key) {
            storage.removeItem(key);
        };
        StorageUtil.key = function (storage, index) {
            return storage.key(index);
        };
        StorageUtil.getExpired = function (val, unit) {
            if (val <= 0)
                return 0;
            var now = +new Date();
            switch (unit) {
                case 's': // 秒
                    return now + 1000 * val;
                case 'm': // 分
                    return now + 1000 * 60 * val;
                case 'h': // 时
                    return now + 1000 * 60 * 60 * val;
                case 'd': // 天
                    return now + 1000 * 60 * 60 * 24 * val;
                case 'w': // 周
                    return now + 1000 * 60 * 60 * 24 * 7 * val;
                case 'y': // 年
                    return now + 1000 * 60 * 60 * 24 * 365 * val;
                case 't': // 自定义
                    return now + val;
            }
            return 0;
        };
        StorageUtil.stringify = function (value) {
            return JSON.stringify(value);
        };
        StorageUtil.parse = function (text) {
            try {
                return JSON.parse(text) || null;
            }
            catch (e) {
                return text;
            }
        };
        return StorageUtil;
    }());

    var cache = {};
    function WebStorage(storage, key, expiredAt, expiredUnit) {
        if (expiredAt === void 0) {
            expiredAt = 0;
        }
        if (expiredUnit === void 0) {
            expiredUnit = 'd';
        }
        return function (target, propertyName) {
            key = key || propertyName;
            Object.defineProperty(target, propertyName, {
                get: function () {
                    return StorageUtil.get(storage, key);
                },
                set: function (value) {
                    if (!cache[key]) {
                        var storedValue = StorageUtil.get(storage, key);
                        if (storedValue === null) {
                            StorageUtil.set(storage, key, value, expiredAt, expiredUnit);
                        }
                        cache[key] = true;
                        return;
                    }
                    StorageUtil.set(storage, key, value, expiredAt, expiredUnit);
                },
                enumerable: true,
                configurable: true,
            });
        };
    }
    /**
     * localStorage 装饰器
     *
     * @param [key] 指定一个新key
     * @param [expiredAt=0] 过期时间值，0表示永久有效。
     * @param [expiredUnit='t'] 过期时间单位（默认：自定义[单位：毫秒]）
     */
    function LocalStorage(key, expiredAt, expiredUnit) {
        if (expiredAt === void 0) {
            expiredAt = 0;
        }
        if (expiredUnit === void 0) {
            expiredUnit = 't';
        }
        return WebStorage(localStorage, key, expiredAt, expiredUnit);
    }
    /**
     * sessionStorage 装饰器
     *
     * @param [key] 指定一个新key
     * @param [expiredAt=0] 过期时间值，0表示在 `sessionStorage` 有效时期范围内永久有效。
     * @param [expiredUnit='t'] 过期时间单位（默认：自定义[单位：毫秒]）
     */
    function SessionStorage(key, expiredAt, expiredUnit) {
        if (expiredAt === void 0) {
            expiredAt = 0;
        }
        if (expiredUnit === void 0) {
            expiredUnit = 't';
        }
        return WebStorage(sessionStorage, key, expiredAt, expiredUnit);
    }

    var __extends = (this && this.__extends) || (function () {
        var extendStatics = function (d, b) {
            extendStatics = Object.setPrototypeOf ||
                ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
                function (d, b) { for (var p in b)
                    if (b.hasOwnProperty(p))
                        d[p] = b[p]; };
            return extendStatics(d, b);
        };
        return function (d, b) {
            extendStatics(d, b);
            function __() { this.constructor = d; }
            d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
        };
    })();
    var StorageService = /** @class */ (function () {
        function StorageService(storage) {
            this.storage = storage;
        }
        StorageService.prototype.get = function (key) {
            return StorageUtil.get(this.storage, key);
        };
        StorageService.prototype.set = function (key, value, expiredAt, expiredUnit) {
            if (expiredAt === void 0) {
                expiredAt = 0;
            }
            if (expiredUnit === void 0) {
                expiredUnit = 'd';
            }
            return StorageUtil.set(this.storage, key, value, expiredAt, expiredUnit);
        };
        /**
         * 删除指定key，如：
         * - `remove('key')` 删除 `key` 键
         * - `remove(/BMap_\w+/)` 批量删除所有 BMap_ 开头的键
         * @param key 键名或正则表达式
         */
        StorageService.prototype.remove = function (key) {
            var _this = this;
            if (typeof key === 'string') {
                StorageUtil.remove(this.storage, key);
                return;
            }
            var index = 0;
            var next = StorageUtil.key(this.storage, index);
            var ls = [];
            while (next) {
                if (key.test(next))
                    ls.push(next);
                next = StorageUtil.key(this.storage, ++index);
            }
            ls.forEach(function (v) { return StorageUtil.remove(_this.storage, v); });
        };
        StorageService.prototype.clear = function () {
            this.storage.clear();
        };
        return StorageService;
    }());
    var LocalStorageService = /** @class */ (function (_super) {
        __extends(LocalStorageService, _super);
        function LocalStorageService() {
            return _super.call(this, localStorage) || this;
        }
        LocalStorageService.decorators = [
            { type: i0.Injectable, args: [{ providedIn: 'root' },] }
        ];
        /** @nocollapse */
        LocalStorageService.ctorParameters = function () { return []; };
        LocalStorageService.ngInjectableDef = i0.defineInjectable({ factory: function LocalStorageService_Factory() { return new LocalStorageService(); }, token: LocalStorageService, providedIn: "root" });
        return LocalStorageService;
    }(StorageService));
    var SessionStorageService = /** @class */ (function (_super) {
        __extends(SessionStorageService, _super);
        function SessionStorageService() {
            return _super.call(this, sessionStorage) || this;
        }
        SessionStorageService.decorators = [
            { type: i0.Injectable, args: [{ providedIn: 'root' },] }
        ];
        /** @nocollapse */
        SessionStorageService.ctorParameters = function () { return []; };
        SessionStorageService.ngInjectableDef = i0.defineInjectable({ factory: function SessionStorageService_Factory() { return new SessionStorageService(); }, token: SessionStorageService, providedIn: "root" });
        return SessionStorageService;
    }(StorageService));

    var AngularWebStorageModule = /** @class */ (function () {
        function AngularWebStorageModule() {
        }
        AngularWebStorageModule.decorators = [
            { type: i0.NgModule }
        ];
        return AngularWebStorageModule;
    }());

    /**
     * Generated bundle index. Do not edit.
     */

    exports.LocalStorage = LocalStorage;
    exports.SessionStorage = SessionStorage;
    exports.StorageService = StorageService;
    exports.LocalStorageService = LocalStorageService;
    exports.SessionStorageService = SessionStorageService;
    exports.AngularWebStorageModule = AngularWebStorageModule;

    Object.defineProperty(exports, '__esModule', { value: true });

})));

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYW5ndWxhci13ZWItc3RvcmFnZS51bWQuanMubWFwIiwic291cmNlcyI6WyJuZzovL2FuZ3VsYXItd2ViLXN0b3JhZ2Uvc3JjL3V0aWwudHMiLCJuZzovL2FuZ3VsYXItd2ViLXN0b3JhZ2Uvc3JjL2RlY29yYXRvci50cyIsIm5nOi8vYW5ndWxhci13ZWItc3RvcmFnZS9zcmMvc2VydmljZS50cyIsIm5nOi8vYW5ndWxhci13ZWItc3RvcmFnZS9zcmMvbW9kdWxlLnRzIiwibmc6Ly9hbmd1bGFyLXdlYi1zdG9yYWdlL2FuZ3VsYXItd2ViLXN0b3JhZ2UudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIMOowr/Ch8OmwpzCn8OmwpfCtsOpwpfCtMOlwo3ClcOkwr3CjVxyXG4gKiBzw6/CvMKaw6fCp8KSXHJcbiAqIG3Dr8K8wprDpcKIwoZcclxuICogaMOvwrzCmsOmwpfCtlxyXG4gKiBkw6/CvMKaw6XCpMKpXHJcbiAqIHfDr8K8wprDpcKRwqhcclxuICogecOvwrzCmsOlwrnCtFxyXG4gKiB0w6/CvMKaw6jCh8Kqw6XCrsKaw6TCucKJw6/CvMKIw6bCr8Krw6fCp8KSbXPDr8K8wolcclxuICovXHJcbmV4cG9ydCB0eXBlIEV4cGlyZWRVbml0ID0gJ3MnIHwgJ20nIHwgJ2gnIHwgJ2QnIHwgJ3cnIHwgJ3knIHwgJ3QnO1xyXG5cclxuZXhwb3J0IGNsYXNzIFN0b3JhZ2VVdGlsIHtcclxuICBzdGF0aWMgZ2V0KHN0b3JhZ2U6IFN0b3JhZ2UsIGtleTogc3RyaW5nKSB7XHJcbiAgICBjb25zdCB2YWx1ZSA9IFN0b3JhZ2VVdGlsLnBhcnNlKHN0b3JhZ2UuZ2V0SXRlbShrZXkpIHx8ICdudWxsJykgfHwgbnVsbDtcclxuICAgIGlmICh2YWx1ZSA9PT0gbnVsbCkgcmV0dXJuIG51bGw7XHJcbiAgICBpZiAoXHJcbiAgICAgIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiZcclxuICAgICAgdHlwZW9mIHZhbHVlLl9leHBpcmVkICE9PSAndW5kZWZpbmVkJyAmJlxyXG4gICAgICB2YWx1ZS5fZXhwaXJlZCAhPT0gMCAmJlxyXG4gICAgICArbmV3IERhdGUoKSA+IHZhbHVlLl9leHBpcmVkXHJcbiAgICApIHtcclxuICAgICAgU3RvcmFnZVV0aWwucmVtb3ZlKHN0b3JhZ2UsIGtleSk7XHJcbiAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB2YWx1ZS5fdmFsdWUgfHwgbnVsbDtcclxuICB9XHJcblxyXG4gIHN0YXRpYyBzZXQoXHJcbiAgICBzdG9yYWdlOiBTdG9yYWdlLFxyXG4gICAga2V5OiBzdHJpbmcsXHJcbiAgICB2YWx1ZTogYW55LFxyXG4gICAgZXhwaXJlZEF0OiBudW1iZXIgPSAwLFxyXG4gICAgZXhwaXJlZFVuaXQ6IEV4cGlyZWRVbml0ID0gJ3QnLFxyXG4gICkge1xyXG4gICAgc3RvcmFnZS5zZXRJdGVtKFxyXG4gICAgICBrZXksXHJcbiAgICAgIFN0b3JhZ2VVdGlsLnN0cmluZ2lmeSh7XHJcbiAgICAgICAgX2V4cGlyZWQ6IFN0b3JhZ2VVdGlsLmdldEV4cGlyZWQoZXhwaXJlZEF0LCBleHBpcmVkVW5pdCksXHJcbiAgICAgICAgX3ZhbHVlOiB2YWx1ZSxcclxuICAgICAgfSksXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgc3RhdGljIHJlbW92ZShzdG9yYWdlOiBTdG9yYWdlLCBrZXk6IHN0cmluZykge1xyXG4gICAgc3RvcmFnZS5yZW1vdmVJdGVtKGtleSk7XHJcbiAgfVxyXG5cclxuICBzdGF0aWMga2V5KHN0b3JhZ2U6IFN0b3JhZ2UsIGluZGV4OiBudW1iZXIpIHtcclxuICAgIHJldHVybiBzdG9yYWdlLmtleShpbmRleCk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHN0YXRpYyBnZXRFeHBpcmVkKHZhbDogbnVtYmVyLCB1bml0OiBFeHBpcmVkVW5pdCk6IG51bWJlciB7XHJcbiAgICBpZiAodmFsIDw9IDApIHJldHVybiAwO1xyXG4gICAgY29uc3Qgbm93ID0gK25ldyBEYXRlKCk7XHJcbiAgICBzd2l0Y2ggKHVuaXQpIHtcclxuICAgICAgY2FzZSAncyc6IC8vIMOnwqfCklxyXG4gICAgICAgIHJldHVybiBub3cgKyAxMDAwICogdmFsO1xyXG4gICAgICBjYXNlICdtJzogLy8gw6XCiMKGXHJcbiAgICAgICAgcmV0dXJuIG5vdyArIDEwMDAgKiA2MCAqIHZhbDtcclxuICAgICAgY2FzZSAnaCc6IC8vIMOmwpfCtlxyXG4gICAgICAgIHJldHVybiBub3cgKyAxMDAwICogNjAgKiA2MCAqIHZhbDtcclxuICAgICAgY2FzZSAnZCc6IC8vIMOlwqTCqVxyXG4gICAgICAgIHJldHVybiBub3cgKyAxMDAwICogNjAgKiA2MCAqIDI0ICogdmFsO1xyXG4gICAgICBjYXNlICd3JzogLy8gw6XCkcKoXHJcbiAgICAgICAgcmV0dXJuIG5vdyArIDEwMDAgKiA2MCAqIDYwICogMjQgKiA3ICogdmFsO1xyXG4gICAgICBjYXNlICd5JzogLy8gw6XCucK0XHJcbiAgICAgICAgcmV0dXJuIG5vdyArIDEwMDAgKiA2MCAqIDYwICogMjQgKiAzNjUgKiB2YWw7XHJcbiAgICAgIGNhc2UgJ3QnOiAvLyDDqMKHwqrDpcKuwprDpMK5wolcclxuICAgICAgICByZXR1cm4gbm93ICsgdmFsO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIDA7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHN0YXRpYyBzdHJpbmdpZnkodmFsdWU6IGFueSkge1xyXG4gICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KHZhbHVlKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgc3RhdGljIHBhcnNlKHRleHQ6IHN0cmluZykge1xyXG4gICAgdHJ5IHtcclxuICAgICAgcmV0dXJuIEpTT04ucGFyc2UodGV4dCkgfHwgbnVsbDtcclxuICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgcmV0dXJuIHRleHQ7XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcbiIsImltcG9ydCB7IEV4cGlyZWRVbml0LCBTdG9yYWdlVXRpbCB9IGZyb20gJy4vdXRpbCc7XHJcblxyXG5pbnRlcmZhY2UgSUNhY2hlIHtcclxuICBba2V5OiBzdHJpbmddOiBib29sZWFuO1xyXG59XHJcbmNvbnN0IGNhY2hlOiBJQ2FjaGUgPSB7fTtcclxuXHJcbmZ1bmN0aW9uIFdlYlN0b3JhZ2UoXHJcbiAgc3RvcmFnZTogU3RvcmFnZSxcclxuICBrZXk6IHN0cmluZyxcclxuICBleHBpcmVkQXQ6IG51bWJlciA9IDAsXHJcbiAgZXhwaXJlZFVuaXQ6IEV4cGlyZWRVbml0ID0gJ2QnLFxyXG4pIHtcclxuICByZXR1cm4gKHRhcmdldDogT2JqZWN0LCBwcm9wZXJ0eU5hbWU6IHN0cmluZyk6IHZvaWQgPT4ge1xyXG4gICAga2V5ID0ga2V5IHx8IHByb3BlcnR5TmFtZTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIHByb3BlcnR5TmFtZSwge1xyXG4gICAgICBnZXQ6ICgpID0+IHtcclxuICAgICAgICByZXR1cm4gU3RvcmFnZVV0aWwuZ2V0KHN0b3JhZ2UsIDxzdHJpbmc+a2V5KTtcclxuICAgICAgfSxcclxuICAgICAgc2V0OiAodmFsdWU6IGFueSkgPT4ge1xyXG4gICAgICAgIGlmICghY2FjaGVbPHN0cmluZz5rZXldKSB7XHJcbiAgICAgICAgICBjb25zdCBzdG9yZWRWYWx1ZSA9IFN0b3JhZ2VVdGlsLmdldChzdG9yYWdlLCA8c3RyaW5nPmtleSk7XHJcbiAgICAgICAgICBpZiAoc3RvcmVkVmFsdWUgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgU3RvcmFnZVV0aWwuc2V0KFxyXG4gICAgICAgICAgICAgIHN0b3JhZ2UsXHJcbiAgICAgICAgICAgICAgPHN0cmluZz5rZXksXHJcbiAgICAgICAgICAgICAgdmFsdWUsXHJcbiAgICAgICAgICAgICAgZXhwaXJlZEF0LFxyXG4gICAgICAgICAgICAgIGV4cGlyZWRVbml0LFxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgY2FjaGVbPHN0cmluZz5rZXldID0gdHJ1ZTtcclxuICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgU3RvcmFnZVV0aWwuc2V0KHN0b3JhZ2UsIDxzdHJpbmc+a2V5LCB2YWx1ZSwgZXhwaXJlZEF0LCBleHBpcmVkVW5pdCk7XHJcbiAgICAgIH0sXHJcbiAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcclxuICAgIH0pO1xyXG4gIH07XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBsb2NhbFN0b3JhZ2Ugw6jCo8KFw6nCpcKww6XCmcKoXHJcbiAqXHJcbiAqIEBwYXJhbSBba2V5XSDDpsKMwofDpcKuwprDpMK4woDDpMK4wqrDpsKWwrBrZXlcclxuICogQHBhcmFtIFtleHBpcmVkQXQ9MF0gw6jCv8KHw6bCnMKfw6bCl8K2w6nCl8K0w6XCgMK8w6/CvMKMMMOowqHCqMOnwqTCusOmwrDCuMOkwrnChcOmwpzCicOmwpXCiMOjwoDCglxyXG4gKiBAcGFyYW0gW2V4cGlyZWRVbml0PSd0J10gw6jCv8KHw6bCnMKfw6bCl8K2w6nCl8K0w6XCjcKVw6TCvcKNw6/CvMKIw6nCu8KYw6jCrsKkw6/CvMKaw6jCh8Kqw6XCrsKaw6TCucKJW8Olwo3ClcOkwr3CjcOvwrzCmsOmwq/Cq8OnwqfCkl3Dr8K8wolcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBMb2NhbFN0b3JhZ2UoXHJcbiAga2V5Pzogc3RyaW5nLFxyXG4gIGV4cGlyZWRBdDogbnVtYmVyID0gMCxcclxuICBleHBpcmVkVW5pdDogRXhwaXJlZFVuaXQgPSAndCcsXHJcbikge1xyXG4gIHJldHVybiBXZWJTdG9yYWdlKGxvY2FsU3RvcmFnZSwga2V5LCBleHBpcmVkQXQsIGV4cGlyZWRVbml0KTtcclxufVxyXG5cclxuLyoqXHJcbiAqIHNlc3Npb25TdG9yYWdlIMOowqPChcOpwqXCsMOlwpnCqFxyXG4gKlxyXG4gKiBAcGFyYW0gW2tleV0gw6bCjMKHw6XCrsKaw6TCuMKAw6TCuMKqw6bClsKwa2V5XHJcbiAqIEBwYXJhbSBbZXhwaXJlZEF0PTBdIMOowr/Ch8OmwpzCn8OmwpfCtsOpwpfCtMOlwoDCvMOvwrzCjDDDqMKhwqjDp8KkwrrDpcKcwqggYHNlc3Npb25TdG9yYWdlYCDDpsKcwonDpsKVwojDpsKXwrbDpsKcwp/DqMKMwoPDpcKbwrTDpcKGwoXDpsKwwrjDpMK5woXDpsKcwonDpsKVwojDo8KAwoJcclxuICogQHBhcmFtIFtleHBpcmVkVW5pdD0ndCddIMOowr/Ch8OmwpzCn8OmwpfCtsOpwpfCtMOlwo3ClcOkwr3CjcOvwrzCiMOpwrvCmMOowq7CpMOvwrzCmsOowofCqsOlwq7CmsOkwrnCiVvDpcKNwpXDpMK9wo3Dr8K8wprDpsKvwqvDp8KnwpJdw6/CvMKJXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gU2Vzc2lvblN0b3JhZ2UoXHJcbiAga2V5Pzogc3RyaW5nLFxyXG4gIGV4cGlyZWRBdDogbnVtYmVyID0gMCxcclxuICBleHBpcmVkVW5pdDogRXhwaXJlZFVuaXQgPSAndCcsXHJcbikge1xyXG4gIHJldHVybiBXZWJTdG9yYWdlKHNlc3Npb25TdG9yYWdlLCBrZXksIGV4cGlyZWRBdCwgZXhwaXJlZFVuaXQpO1xyXG59XHJcbiIsImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgU3RvcmFnZVV0aWwsIEV4cGlyZWRVbml0IH0gZnJvbSAnLi91dGlsJztcclxuXHJcbmV4cG9ydCBjbGFzcyBTdG9yYWdlU2VydmljZSB7XHJcbiAgY29uc3RydWN0b3IocHJpdmF0ZSBzdG9yYWdlOiBTdG9yYWdlKSB7fVxyXG5cclxuICBnZXQoa2V5OiBzdHJpbmcpIHtcclxuICAgIHJldHVybiBTdG9yYWdlVXRpbC5nZXQodGhpcy5zdG9yYWdlLCBrZXkpO1xyXG4gIH1cclxuXHJcbiAgc2V0KFxyXG4gICAga2V5OiBzdHJpbmcsXHJcbiAgICB2YWx1ZTogYW55LFxyXG4gICAgZXhwaXJlZEF0OiBudW1iZXIgPSAwLFxyXG4gICAgZXhwaXJlZFVuaXQ6IEV4cGlyZWRVbml0ID0gJ2QnLFxyXG4gICkge1xyXG4gICAgcmV0dXJuIFN0b3JhZ2VVdGlsLnNldCh0aGlzLnN0b3JhZ2UsIGtleSwgdmFsdWUsIGV4cGlyZWRBdCwgZXhwaXJlZFVuaXQpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogw6XCiMKgw6nCmcKkw6bCjMKHw6XCrsKaa2V5w6/CvMKMw6XCpsKCw6/CvMKaXHJcbiAgICogLSBgcmVtb3ZlKCdrZXknKWAgw6XCiMKgw6nCmcKkIGBrZXlgIMOpwpTCrlxyXG4gICAqIC0gYHJlbW92ZSgvQk1hcF9cXHcrLylgIMOmwonCucOpwofCj8OlwojCoMOpwpnCpMOmwonCgMOmwpzCiSBCTWFwXyDDpcK8woDDpcKkwrTDp8KawoTDqcKUwq5cclxuICAgKiBAcGFyYW0ga2V5IMOpwpTCrsOlwpDCjcOmwojClsOmwq3Co8OlwojCmcOowqHCqMOowr7CvsOlwrzCj1xyXG4gICAqL1xyXG4gIHJlbW92ZShrZXk6IHN0cmluZyB8IFJlZ0V4cCkge1xyXG4gICAgaWYgKHR5cGVvZiBrZXkgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgIFN0b3JhZ2VVdGlsLnJlbW92ZSh0aGlzLnN0b3JhZ2UsIGtleSk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGxldCBpbmRleCA9IDA7XHJcbiAgICBsZXQgbmV4dCA9IFN0b3JhZ2VVdGlsLmtleSh0aGlzLnN0b3JhZ2UsIGluZGV4KTtcclxuICAgIGNvbnN0IGxzOiBzdHJpbmdbXSA9IFtdO1xyXG4gICAgd2hpbGUgKG5leHQpIHtcclxuICAgICAgaWYgKGtleS50ZXN0KG5leHQpKSBscy5wdXNoKG5leHQpO1xyXG4gICAgICBuZXh0ID0gU3RvcmFnZVV0aWwua2V5KHRoaXMuc3RvcmFnZSwgKytpbmRleCk7XHJcbiAgICB9XHJcbiAgICBscy5mb3JFYWNoKHYgPT4gU3RvcmFnZVV0aWwucmVtb3ZlKHRoaXMuc3RvcmFnZSwgdikpO1xyXG4gIH1cclxuXHJcbiAgY2xlYXIoKSB7XHJcbiAgICB0aGlzLnN0b3JhZ2UuY2xlYXIoKTtcclxuICB9XHJcbn1cclxuXHJcbkBJbmplY3RhYmxlKHsgcHJvdmlkZWRJbjogJ3Jvb3QnIH0pXHJcbmV4cG9ydCBjbGFzcyBMb2NhbFN0b3JhZ2VTZXJ2aWNlIGV4dGVuZHMgU3RvcmFnZVNlcnZpY2Uge1xyXG4gIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgc3VwZXIobG9jYWxTdG9yYWdlKTtcclxuICB9XHJcbn1cclxuXHJcbkBJbmplY3RhYmxlKHsgcHJvdmlkZWRJbjogJ3Jvb3QnIH0pXHJcbmV4cG9ydCBjbGFzcyBTZXNzaW9uU3RvcmFnZVNlcnZpY2UgZXh0ZW5kcyBTdG9yYWdlU2VydmljZSB7XHJcbiAgY29uc3RydWN0b3IoKSB7XHJcbiAgICBzdXBlcihzZXNzaW9uU3RvcmFnZSk7XHJcbiAgfVxyXG59XHJcbiIsImltcG9ydCB7IE5nTW9kdWxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcblxyXG5ATmdNb2R1bGUoKVxyXG5leHBvcnQgY2xhc3MgQW5ndWxhcldlYlN0b3JhZ2VNb2R1bGUge31cclxuIiwiLyoqXG4gKiBHZW5lcmF0ZWQgYnVuZGxlIGluZGV4LiBEbyBub3QgZWRpdC5cbiAqL1xuXG5leHBvcnQgKiBmcm9tICcuL2luZGV4JztcbiJdLCJuYW1lcyI6WyJJbmplY3RhYmxlIiwiTmdNb2R1bGUiXSwibWFwcGluZ3MiOiI7Ozs7OztJQVlBO1FBQUE7U0EwRUM7UUF6RVEsZUFBRyxHQUFWLFVBQVcsT0FBZ0IsRUFBRSxHQUFXO1lBQ3RDLElBQU0sS0FBSyxHQUFHLFdBQVcsQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsSUFBSSxNQUFNLENBQUMsSUFBSSxJQUFJLENBQUM7WUFDeEUsSUFBSSxLQUFLLEtBQUssSUFBSTtnQkFBRSxPQUFPLElBQUksQ0FBQztZQUNoQyxJQUNFLE9BQU8sS0FBSyxLQUFLLFFBQVE7Z0JBQ3pCLE9BQU8sS0FBSyxDQUFDLFFBQVEsS0FBSyxXQUFXO2dCQUNyQyxLQUFLLENBQUMsUUFBUSxLQUFLLENBQUM7Z0JBQ3BC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