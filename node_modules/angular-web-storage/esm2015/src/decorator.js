import { StorageUtil } from './util';
const cache = {};
function WebStorage(storage, key, expiredAt = 0, expiredUnit = 'd') {
    return (target, propertyName) => {
        key = key || propertyName;
        Object.defineProperty(target, propertyName, {
            get: () => {
                return StorageUtil.get(storage, key);
            },
            set: (value) => {
                if (!cache[key]) {
                    const storedValue = StorageUtil.get(storage, key);
                    if (storedValue === null) {
                        StorageUtil.set(storage, key, value, expiredAt, expiredUnit);
                    }
                    cache[key] = true;
                    return;
                }
                StorageUtil.set(storage, key, value, expiredAt, expiredUnit);
            },
            enumerable: true,
            configurable: true,
        });
    };
}
/**
 * localStorage 装饰器
 *
 * @param [key] 指定一个新key
 * @param [expiredAt=0] 过期时间值，0表示永久有效。
 * @param [expiredUnit='t'] 过期时间单位（默认：自定义[单位：毫秒]）
 */
export function LocalStorage(key, expiredAt = 0, expiredUnit = 't') {
    return WebStorage(localStorage, key, expiredAt, expiredUnit);
}
/**
 * sessionStorage 装饰器
 *
 * @param [key] 指定一个新key
 * @param [expiredAt=0] 过期时间值，0表示在 `sessionStorage` 有效时期范围内永久有效。
 * @param [expiredUnit='t'] 过期时间单位（默认：自定义[单位：毫秒]）
 */
export function SessionStorage(key, expiredAt = 0, expiredUnit = 't') {
    return WebStorage(sessionStorage, key, expiredAt, expiredUnit);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGVjb3JhdG9yLmpzIiwic291cmNlUm9vdCI6Im5nOi8vYW5ndWxhci13ZWItc3RvcmFnZS8iLCJzb3VyY2VzIjpbInNyYy9kZWNvcmF0b3IudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFlLFdBQVcsRUFBRSxNQUFNLFFBQVEsQ0FBQztBQUtsRCxNQUFNLEtBQUssR0FBVyxFQUFFLENBQUM7QUFFekIsU0FBUyxVQUFVLENBQ2pCLE9BQWdCLEVBQ2hCLEdBQVcsRUFDWCxZQUFvQixDQUFDLEVBQ3JCLGNBQTJCLEdBQUc7SUFFOUIsT0FBTyxDQUFDLE1BQWMsRUFBRSxZQUFvQixFQUFRLEVBQUU7UUFDcEQsR0FBRyxHQUFHLEdBQUcsSUFBSSxZQUFZLENBQUM7UUFDMUIsTUFBTSxDQUFDLGNBQWMsQ0FBQyxNQUFNLEVBQUUsWUFBWSxFQUFFO1lBQzFDLEdBQUcsRUFBRSxHQUFHLEVBQUU7Z0JBQ1IsT0FBTyxXQUFXLENBQUMsR0FBRyxDQUFDLE9BQU8sRUFBVSxHQUFHLENBQUMsQ0FBQztZQUMvQyxDQUFDO1lBQ0QsR0FBRyxFQUFFLENBQUMsS0FBVSxFQUFFLEVBQUU7Z0JBQ2xCLElBQUksQ0FBQyxLQUFLLENBQVMsR0FBRyxDQUFDLEVBQUU7b0JBQ3ZCLE1BQU0sV0FBVyxHQUFHLFdBQVcsQ0FBQyxHQUFHLENBQUMsT0FBTyxFQUFVLEdBQUcsQ0FBQyxDQUFDO29CQUMxRCxJQUFJLFdBQVcsS0FBSyxJQUFJLEVBQUU7d0JBQ3hCLFdBQVcsQ0FBQyxHQUFHLENBQ2IsT0FBTyxFQUNDLEdBQUcsRUFDWCxLQUFLLEVBQ0wsU0FBUyxFQUNULFdBQVcsQ0FDWixDQUFDO3FCQUNIO29CQUNELEtBQUssQ0FBUyxHQUFHLENBQUMsR0FBRyxJQUFJLENBQUM7b0JBQzFCLE9BQU87aUJBQ1I7Z0JBQ0QsV0FBVyxDQUFDLEdBQUcsQ0FBQyxPQUFPLEVBQVUsR0FBRyxFQUFFLEtBQUssRUFBRSxTQUFTLEVBQUUsV0FBVyxDQUFDLENBQUM7WUFDdkUsQ0FBQztZQUNELFVBQVUsRUFBRSxJQUFJO1lBQ2hCLFlBQVksRUFBRSxJQUFJO1NBQ25CLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQztBQUNKLENBQUM7QUFFRDs7Ozs7O0dBTUc7QUFDSCxNQUFNLFVBQVUsWUFBWSxDQUMxQixHQUFZLEVBQ1osWUFBb0IsQ0FBQyxFQUNyQixjQUEyQixHQUFHO0lBRTlCLE9BQU8sVUFBVSxDQUFDLFlBQVksRUFBRSxHQUFHLEVBQUUsU0FBUyxFQUFFLFdBQVcsQ0FBQyxDQUFDO0FBQy9ELENBQUM7QUFFRDs7Ozs7O0dBTUc7QUFDSCxNQUFNLFVBQVUsY0FBYyxDQUM1QixHQUFZLEVBQ1osWUFBb0IsQ0FBQyxFQUNyQixjQUEyQixHQUFHO0lBRTlCLE9BQU8sVUFBVSxDQUFDLGNBQWMsRUFBRSxHQUFHLEVBQUUsU0FBUyxFQUFFLFdBQVcsQ0FBQyxDQUFDO0FBQ2pFLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBFeHBpcmVkVW5pdCwgU3RvcmFnZVV0aWwgfSBmcm9tICcuL3V0aWwnO1xyXG5cclxuaW50ZXJmYWNlIElDYWNoZSB7XHJcbiAgW2tleTogc3RyaW5nXTogYm9vbGVhbjtcclxufVxyXG5jb25zdCBjYWNoZTogSUNhY2hlID0ge307XHJcblxyXG5mdW5jdGlvbiBXZWJTdG9yYWdlKFxyXG4gIHN0b3JhZ2U6IFN0b3JhZ2UsXHJcbiAga2V5OiBzdHJpbmcsXHJcbiAgZXhwaXJlZEF0OiBudW1iZXIgPSAwLFxyXG4gIGV4cGlyZWRVbml0OiBFeHBpcmVkVW5pdCA9ICdkJyxcclxuKSB7XHJcbiAgcmV0dXJuICh0YXJnZXQ6IE9iamVjdCwgcHJvcGVydHlOYW1lOiBzdHJpbmcpOiB2b2lkID0+IHtcclxuICAgIGtleSA9IGtleSB8fCBwcm9wZXJ0eU5hbWU7XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBwcm9wZXJ0eU5hbWUsIHtcclxuICAgICAgZ2V0OiAoKSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIFN0b3JhZ2VVdGlsLmdldChzdG9yYWdlLCA8c3RyaW5nPmtleSk7XHJcbiAgICAgIH0sXHJcbiAgICAgIHNldDogKHZhbHVlOiBhbnkpID0+IHtcclxuICAgICAgICBpZiAoIWNhY2hlWzxzdHJpbmc+a2V5XSkge1xyXG4gICAgICAgICAgY29uc3Qgc3RvcmVkVmFsdWUgPSBTdG9yYWdlVXRpbC5nZXQoc3RvcmFnZSwgPHN0cmluZz5rZXkpO1xyXG4gICAgICAgICAgaWYgKHN0b3JlZFZhbHVlID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgIFN0b3JhZ2VVdGlsLnNldChcclxuICAgICAgICAgICAgICBzdG9yYWdlLFxyXG4gICAgICAgICAgICAgIDxzdHJpbmc+a2V5LFxyXG4gICAgICAgICAgICAgIHZhbHVlLFxyXG4gICAgICAgICAgICAgIGV4cGlyZWRBdCxcclxuICAgICAgICAgICAgICBleHBpcmVkVW5pdCxcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGNhY2hlWzxzdHJpbmc+a2V5XSA9IHRydWU7XHJcbiAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFN0b3JhZ2VVdGlsLnNldChzdG9yYWdlLCA8c3RyaW5nPmtleSwgdmFsdWUsIGV4cGlyZWRBdCwgZXhwaXJlZFVuaXQpO1xyXG4gICAgICB9LFxyXG4gICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICBjb25maWd1cmFibGU6IHRydWUsXHJcbiAgICB9KTtcclxuICB9O1xyXG59XHJcblxyXG4vKipcclxuICogbG9jYWxTdG9yYWdlIOijhemlsOWZqFxyXG4gKlxyXG4gKiBAcGFyYW0gW2tleV0g5oyH5a6a5LiA5Liq5pawa2V5XHJcbiAqIEBwYXJhbSBbZXhwaXJlZEF0PTBdIOi/h+acn+aXtumXtOWAvO+8jDDooajnpLrmsLjkuYXmnInmlYjjgIJcclxuICogQHBhcmFtIFtleHBpcmVkVW5pdD0ndCddIOi/h+acn+aXtumXtOWNleS9je+8iOm7mOiupO+8muiHquWumuS5iVvljZXkvY3vvJrmr6vnp5Jd77yJXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gTG9jYWxTdG9yYWdlKFxyXG4gIGtleT86IHN0cmluZyxcclxuICBleHBpcmVkQXQ6IG51bWJlciA9IDAsXHJcbiAgZXhwaXJlZFVuaXQ6IEV4cGlyZWRVbml0ID0gJ3QnLFxyXG4pIHtcclxuICByZXR1cm4gV2ViU3RvcmFnZShsb2NhbFN0b3JhZ2UsIGtleSwgZXhwaXJlZEF0LCBleHBpcmVkVW5pdCk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBzZXNzaW9uU3RvcmFnZSDoo4XppbDlmahcclxuICpcclxuICogQHBhcmFtIFtrZXldIOaMh+WumuS4gOS4quaWsGtleVxyXG4gKiBAcGFyYW0gW2V4cGlyZWRBdD0wXSDov4fmnJ/ml7bpl7TlgLzvvIww6KGo56S65ZyoIGBzZXNzaW9uU3RvcmFnZWAg5pyJ5pWI5pe25pyf6IyD5Zu05YaF5rC45LmF5pyJ5pWI44CCXHJcbiAqIEBwYXJhbSBbZXhwaXJlZFVuaXQ9J3QnXSDov4fmnJ/ml7bpl7TljZXkvY3vvIjpu5jorqTvvJroh6rlrprkuYlb5Y2V5L2N77ya5q+r56eSXe+8iVxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIFNlc3Npb25TdG9yYWdlKFxyXG4gIGtleT86IHN0cmluZyxcclxuICBleHBpcmVkQXQ6IG51bWJlciA9IDAsXHJcbiAgZXhwaXJlZFVuaXQ6IEV4cGlyZWRVbml0ID0gJ3QnLFxyXG4pIHtcclxuICByZXR1cm4gV2ViU3RvcmFnZShzZXNzaW9uU3RvcmFnZSwga2V5LCBleHBpcmVkQXQsIGV4cGlyZWRVbml0KTtcclxufVxyXG4iXX0=