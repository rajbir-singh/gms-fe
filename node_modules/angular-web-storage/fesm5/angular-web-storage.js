import { Injectable, NgModule, defineInjectable } from '@angular/core';

var StorageUtil = /** @class */ (function () {
    function StorageUtil() {
    }
    StorageUtil.get = function (storage, key) {
        var value = StorageUtil.parse(storage.getItem(key) || 'null') || null;
        if (value === null)
            return null;
        if (typeof value === 'object' &&
            typeof value._expired !== 'undefined' &&
            value._expired !== 0 &&
            +new Date() > value._expired) {
            StorageUtil.remove(storage, key);
            return null;
        }
        return value._value || null;
    };
    StorageUtil.set = function (storage, key, value, expiredAt, expiredUnit) {
        if (expiredAt === void 0) { expiredAt = 0; }
        if (expiredUnit === void 0) { expiredUnit = 't'; }
        storage.setItem(key, StorageUtil.stringify({
            _expired: StorageUtil.getExpired(expiredAt, expiredUnit),
            _value: value,
        }));
    };
    StorageUtil.remove = function (storage, key) {
        storage.removeItem(key);
    };
    StorageUtil.key = function (storage, index) {
        return storage.key(index);
    };
    StorageUtil.getExpired = function (val, unit) {
        if (val <= 0)
            return 0;
        var now = +new Date();
        switch (unit) {
            case 's': // 秒
                return now + 1000 * val;
            case 'm': // 分
                return now + 1000 * 60 * val;
            case 'h': // 时
                return now + 1000 * 60 * 60 * val;
            case 'd': // 天
                return now + 1000 * 60 * 60 * 24 * val;
            case 'w': // 周
                return now + 1000 * 60 * 60 * 24 * 7 * val;
            case 'y': // 年
                return now + 1000 * 60 * 60 * 24 * 365 * val;
            case 't': // 自定义
                return now + val;
        }
        return 0;
    };
    StorageUtil.stringify = function (value) {
        return JSON.stringify(value);
    };
    StorageUtil.parse = function (text) {
        try {
            return JSON.parse(text) || null;
        }
        catch (e) {
            return text;
        }
    };
    return StorageUtil;
}());

var cache = {};
function WebStorage(storage, key, expiredAt, expiredUnit) {
    if (expiredAt === void 0) { expiredAt = 0; }
    if (expiredUnit === void 0) { expiredUnit = 'd'; }
    return function (target, propertyName) {
        key = key || propertyName;
        Object.defineProperty(target, propertyName, {
            get: function () {
                return StorageUtil.get(storage, key);
            },
            set: function (value) {
                if (!cache[key]) {
                    var storedValue = StorageUtil.get(storage, key);
                    if (storedValue === null) {
                        StorageUtil.set(storage, key, value, expiredAt, expiredUnit);
                    }
                    cache[key] = true;
                    return;
                }
                StorageUtil.set(storage, key, value, expiredAt, expiredUnit);
            },
            enumerable: true,
            configurable: true,
        });
    };
}
/**
 * localStorage 装饰器
 *
 * @param [key] 指定一个新key
 * @param [expiredAt=0] 过期时间值，0表示永久有效。
 * @param [expiredUnit='t'] 过期时间单位（默认：自定义[单位：毫秒]）
 */
function LocalStorage(key, expiredAt, expiredUnit) {
    if (expiredAt === void 0) { expiredAt = 0; }
    if (expiredUnit === void 0) { expiredUnit = 't'; }
    return WebStorage(localStorage, key, expiredAt, expiredUnit);
}
/**
 * sessionStorage 装饰器
 *
 * @param [key] 指定一个新key
 * @param [expiredAt=0] 过期时间值，0表示在 `sessionStorage` 有效时期范围内永久有效。
 * @param [expiredUnit='t'] 过期时间单位（默认：自定义[单位：毫秒]）
 */
function SessionStorage(key, expiredAt, expiredUnit) {
    if (expiredAt === void 0) { expiredAt = 0; }
    if (expiredUnit === void 0) { expiredUnit = 't'; }
    return WebStorage(sessionStorage, key, expiredAt, expiredUnit);
}

var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var StorageService = /** @class */ (function () {
    function StorageService(storage) {
        this.storage = storage;
    }
    StorageService.prototype.get = function (key) {
        return StorageUtil.get(this.storage, key);
    };
    StorageService.prototype.set = function (key, value, expiredAt, expiredUnit) {
        if (expiredAt === void 0) { expiredAt = 0; }
        if (expiredUnit === void 0) { expiredUnit = 'd'; }
        return StorageUtil.set(this.storage, key, value, expiredAt, expiredUnit);
    };
    /**
     * 删除指定key，如：
     * - `remove('key')` 删除 `key` 键
     * - `remove(/BMap_\w+/)` 批量删除所有 BMap_ 开头的键
     * @param key 键名或正则表达式
     */
    StorageService.prototype.remove = function (key) {
        var _this = this;
        if (typeof key === 'string') {
            StorageUtil.remove(this.storage, key);
            return;
        }
        var index = 0;
        var next = StorageUtil.key(this.storage, index);
        var ls = [];
        while (next) {
            if (key.test(next))
                ls.push(next);
            next = StorageUtil.key(this.storage, ++index);
        }
        ls.forEach(function (v) { return StorageUtil.remove(_this.storage, v); });
    };
    StorageService.prototype.clear = function () {
        this.storage.clear();
    };
    return StorageService;
}());
var LocalStorageService = /** @class */ (function (_super) {
    __extends(LocalStorageService, _super);
    function LocalStorageService() {
        return _super.call(this, localStorage) || this;
    }
    LocalStorageService.decorators = [
        { type: Injectable, args: [{ providedIn: 'root' },] }
    ];
    /** @nocollapse */
    LocalStorageService.ctorParameters = function () { return []; };
    LocalStorageService.ngInjectableDef = defineInjectable({ factory: function LocalStorageService_Factory() { return new LocalStorageService(); }, token: LocalStorageService, providedIn: "root" });
    return LocalStorageService;
}(StorageService));
var SessionStorageService = /** @class */ (function (_super) {
    __extends(SessionStorageService, _super);
    function SessionStorageService() {
        return _super.call(this, sessionStorage) || this;
    }
    SessionStorageService.decorators = [
        { type: Injectable, args: [{ providedIn: 'root' },] }
    ];
    /** @nocollapse */
    SessionStorageService.ctorParameters = function () { return []; };
    SessionStorageService.ngInjectableDef = defineInjectable({ factory: function SessionStorageService_Factory() { return new SessionStorageService(); }, token: SessionStorageService, providedIn: "root" });
    return SessionStorageService;
}(StorageService));

var AngularWebStorageModule = /** @class */ (function () {
    function AngularWebStorageModule() {
    }
    AngularWebStorageModule.decorators = [
        { type: NgModule }
    ];
    return AngularWebStorageModule;
}());

/**
 * Generated bundle index. Do not edit.
 */

export { LocalStorage, SessionStorage, StorageService, LocalStorageService, SessionStorageService, AngularWebStorageModule };

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYW5ndWxhci13ZWItc3RvcmFnZS5qcy5tYXAiLCJzb3VyY2VzIjpbIm5nOi8vYW5ndWxhci13ZWItc3RvcmFnZS9zcmMvdXRpbC50cyIsIm5nOi8vYW5ndWxhci13ZWItc3RvcmFnZS9zcmMvZGVjb3JhdG9yLnRzIiwibmc6Ly9hbmd1bGFyLXdlYi1zdG9yYWdlL3NyYy9zZXJ2aWNlLnRzIiwibmc6Ly9hbmd1bGFyLXdlYi1zdG9yYWdlL3NyYy9tb2R1bGUudHMiLCJuZzovL2FuZ3VsYXItd2ViLXN0b3JhZ2UvYW5ndWxhci13ZWItc3RvcmFnZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogw6jCv8KHw6bCnMKfw6bCl8K2w6nCl8K0w6XCjcKVw6TCvcKNXHJcbiAqIHPDr8K8wprDp8KnwpJcclxuICogbcOvwrzCmsOlwojChlxyXG4gKiBow6/CvMKaw6bCl8K2XHJcbiAqIGTDr8K8wprDpcKkwqlcclxuICogd8OvwrzCmsOlwpHCqFxyXG4gKiB5w6/CvMKaw6XCucK0XHJcbiAqIHTDr8K8wprDqMKHwqrDpcKuwprDpMK5wonDr8K8wojDpsKvwqvDp8KnwpJtc8OvwrzCiVxyXG4gKi9cclxuZXhwb3J0IHR5cGUgRXhwaXJlZFVuaXQgPSAncycgfCAnbScgfCAnaCcgfCAnZCcgfCAndycgfCAneScgfCAndCc7XHJcblxyXG5leHBvcnQgY2xhc3MgU3RvcmFnZVV0aWwge1xyXG4gIHN0YXRpYyBnZXQoc3RvcmFnZTogU3RvcmFnZSwga2V5OiBzdHJpbmcpIHtcclxuICAgIGNvbnN0IHZhbHVlID0gU3RvcmFnZVV0aWwucGFyc2Uoc3RvcmFnZS5nZXRJdGVtKGtleSkgfHwgJ251bGwnKSB8fCBudWxsO1xyXG4gICAgaWYgKHZhbHVlID09PSBudWxsKSByZXR1cm4gbnVsbDtcclxuICAgIGlmIChcclxuICAgICAgdHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJlxyXG4gICAgICB0eXBlb2YgdmFsdWUuX2V4cGlyZWQgIT09ICd1bmRlZmluZWQnICYmXHJcbiAgICAgIHZhbHVlLl9leHBpcmVkICE9PSAwICYmXHJcbiAgICAgICtuZXcgRGF0ZSgpID4gdmFsdWUuX2V4cGlyZWRcclxuICAgICkge1xyXG4gICAgICBTdG9yYWdlVXRpbC5yZW1vdmUoc3RvcmFnZSwga2V5KTtcclxuICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHZhbHVlLl92YWx1ZSB8fCBudWxsO1xyXG4gIH1cclxuXHJcbiAgc3RhdGljIHNldChcclxuICAgIHN0b3JhZ2U6IFN0b3JhZ2UsXHJcbiAgICBrZXk6IHN0cmluZyxcclxuICAgIHZhbHVlOiBhbnksXHJcbiAgICBleHBpcmVkQXQ6IG51bWJlciA9IDAsXHJcbiAgICBleHBpcmVkVW5pdDogRXhwaXJlZFVuaXQgPSAndCcsXHJcbiAgKSB7XHJcbiAgICBzdG9yYWdlLnNldEl0ZW0oXHJcbiAgICAgIGtleSxcclxuICAgICAgU3RvcmFnZVV0aWwuc3RyaW5naWZ5KHtcclxuICAgICAgICBfZXhwaXJlZDogU3RvcmFnZVV0aWwuZ2V0RXhwaXJlZChleHBpcmVkQXQsIGV4cGlyZWRVbml0KSxcclxuICAgICAgICBfdmFsdWU6IHZhbHVlLFxyXG4gICAgICB9KSxcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBzdGF0aWMgcmVtb3ZlKHN0b3JhZ2U6IFN0b3JhZ2UsIGtleTogc3RyaW5nKSB7XHJcbiAgICBzdG9yYWdlLnJlbW92ZUl0ZW0oa2V5KTtcclxuICB9XHJcblxyXG4gIHN0YXRpYyBrZXkoc3RvcmFnZTogU3RvcmFnZSwgaW5kZXg6IG51bWJlcikge1xyXG4gICAgcmV0dXJuIHN0b3JhZ2Uua2V5KGluZGV4KTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgc3RhdGljIGdldEV4cGlyZWQodmFsOiBudW1iZXIsIHVuaXQ6IEV4cGlyZWRVbml0KTogbnVtYmVyIHtcclxuICAgIGlmICh2YWwgPD0gMCkgcmV0dXJuIDA7XHJcbiAgICBjb25zdCBub3cgPSArbmV3IERhdGUoKTtcclxuICAgIHN3aXRjaCAodW5pdCkge1xyXG4gICAgICBjYXNlICdzJzogLy8gw6fCp8KSXHJcbiAgICAgICAgcmV0dXJuIG5vdyArIDEwMDAgKiB2YWw7XHJcbiAgICAgIGNhc2UgJ20nOiAvLyDDpcKIwoZcclxuICAgICAgICByZXR1cm4gbm93ICsgMTAwMCAqIDYwICogdmFsO1xyXG4gICAgICBjYXNlICdoJzogLy8gw6bCl8K2XHJcbiAgICAgICAgcmV0dXJuIG5vdyArIDEwMDAgKiA2MCAqIDYwICogdmFsO1xyXG4gICAgICBjYXNlICdkJzogLy8gw6XCpMKpXHJcbiAgICAgICAgcmV0dXJuIG5vdyArIDEwMDAgKiA2MCAqIDYwICogMjQgKiB2YWw7XHJcbiAgICAgIGNhc2UgJ3cnOiAvLyDDpcKRwqhcclxuICAgICAgICByZXR1cm4gbm93ICsgMTAwMCAqIDYwICogNjAgKiAyNCAqIDcgKiB2YWw7XHJcbiAgICAgIGNhc2UgJ3knOiAvLyDDpcK5wrRcclxuICAgICAgICByZXR1cm4gbm93ICsgMTAwMCAqIDYwICogNjAgKiAyNCAqIDM2NSAqIHZhbDtcclxuICAgICAgY2FzZSAndCc6IC8vIMOowofCqsOlwq7CmsOkwrnCiVxyXG4gICAgICAgIHJldHVybiBub3cgKyB2YWw7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gMDtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgc3RhdGljIHN0cmluZ2lmeSh2YWx1ZTogYW55KSB7XHJcbiAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkodmFsdWUpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBzdGF0aWMgcGFyc2UodGV4dDogc3RyaW5nKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICByZXR1cm4gSlNPTi5wYXJzZSh0ZXh0KSB8fCBudWxsO1xyXG4gICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICByZXR1cm4gdGV4dDtcclxuICAgIH1cclxuICB9XHJcbn1cclxuIiwiaW1wb3J0IHsgRXhwaXJlZFVuaXQsIFN0b3JhZ2VVdGlsIH0gZnJvbSAnLi91dGlsJztcclxuXHJcbmludGVyZmFjZSBJQ2FjaGUge1xyXG4gIFtrZXk6IHN0cmluZ106IGJvb2xlYW47XHJcbn1cclxuY29uc3QgY2FjaGU6IElDYWNoZSA9IHt9O1xyXG5cclxuZnVuY3Rpb24gV2ViU3RvcmFnZShcclxuICBzdG9yYWdlOiBTdG9yYWdlLFxyXG4gIGtleTogc3RyaW5nLFxyXG4gIGV4cGlyZWRBdDogbnVtYmVyID0gMCxcclxuICBleHBpcmVkVW5pdDogRXhwaXJlZFVuaXQgPSAnZCcsXHJcbikge1xyXG4gIHJldHVybiAodGFyZ2V0OiBPYmplY3QsIHByb3BlcnR5TmFtZTogc3RyaW5nKTogdm9pZCA9PiB7XHJcbiAgICBrZXkgPSBrZXkgfHwgcHJvcGVydHlOYW1lO1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgcHJvcGVydHlOYW1lLCB7XHJcbiAgICAgIGdldDogKCkgPT4ge1xyXG4gICAgICAgIHJldHVybiBTdG9yYWdlVXRpbC5nZXQoc3RvcmFnZSwgPHN0cmluZz5rZXkpO1xyXG4gICAgICB9LFxyXG4gICAgICBzZXQ6ICh2YWx1ZTogYW55KSA9PiB7XHJcbiAgICAgICAgaWYgKCFjYWNoZVs8c3RyaW5nPmtleV0pIHtcclxuICAgICAgICAgIGNvbnN0IHN0b3JlZFZhbHVlID0gU3RvcmFnZVV0aWwuZ2V0KHN0b3JhZ2UsIDxzdHJpbmc+a2V5KTtcclxuICAgICAgICAgIGlmIChzdG9yZWRWYWx1ZSA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICBTdG9yYWdlVXRpbC5zZXQoXHJcbiAgICAgICAgICAgICAgc3RvcmFnZSxcclxuICAgICAgICAgICAgICA8c3RyaW5nPmtleSxcclxuICAgICAgICAgICAgICB2YWx1ZSxcclxuICAgICAgICAgICAgICBleHBpcmVkQXQsXHJcbiAgICAgICAgICAgICAgZXhwaXJlZFVuaXQsXHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBjYWNoZVs8c3RyaW5nPmtleV0gPSB0cnVlO1xyXG4gICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBTdG9yYWdlVXRpbC5zZXQoc3RvcmFnZSwgPHN0cmluZz5rZXksIHZhbHVlLCBleHBpcmVkQXQsIGV4cGlyZWRVbml0KTtcclxuICAgICAgfSxcclxuICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgY29uZmlndXJhYmxlOiB0cnVlLFxyXG4gICAgfSk7XHJcbiAgfTtcclxufVxyXG5cclxuLyoqXHJcbiAqIGxvY2FsU3RvcmFnZSDDqMKjwoXDqcKlwrDDpcKZwqhcclxuICpcclxuICogQHBhcmFtIFtrZXldIMOmwozCh8Olwq7CmsOkwrjCgMOkwrjCqsOmwpbCsGtleVxyXG4gKiBAcGFyYW0gW2V4cGlyZWRBdD0wXSDDqMK/wofDpsKcwp/DpsKXwrbDqcKXwrTDpcKAwrzDr8K8wowww6jCocKow6fCpMK6w6bCsMK4w6TCucKFw6bCnMKJw6bClcKIw6PCgMKCXHJcbiAqIEBwYXJhbSBbZXhwaXJlZFVuaXQ9J3QnXSDDqMK/wofDpsKcwp/DpsKXwrbDqcKXwrTDpcKNwpXDpMK9wo3Dr8K8wojDqcK7wpjDqMKuwqTDr8K8wprDqMKHwqrDpcKuwprDpMK5wolbw6XCjcKVw6TCvcKNw6/CvMKaw6bCr8Krw6fCp8KSXcOvwrzCiVxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIExvY2FsU3RvcmFnZShcclxuICBrZXk/OiBzdHJpbmcsXHJcbiAgZXhwaXJlZEF0OiBudW1iZXIgPSAwLFxyXG4gIGV4cGlyZWRVbml0OiBFeHBpcmVkVW5pdCA9ICd0JyxcclxuKSB7XHJcbiAgcmV0dXJuIFdlYlN0b3JhZ2UobG9jYWxTdG9yYWdlLCBrZXksIGV4cGlyZWRBdCwgZXhwaXJlZFVuaXQpO1xyXG59XHJcblxyXG4vKipcclxuICogc2Vzc2lvblN0b3JhZ2Ugw6jCo8KFw6nCpcKww6XCmcKoXHJcbiAqXHJcbiAqIEBwYXJhbSBba2V5XSDDpsKMwofDpcKuwprDpMK4woDDpMK4wqrDpsKWwrBrZXlcclxuICogQHBhcmFtIFtleHBpcmVkQXQ9MF0gw6jCv8KHw6bCnMKfw6bCl8K2w6nCl8K0w6XCgMK8w6/CvMKMMMOowqHCqMOnwqTCusOlwpzCqCBgc2Vzc2lvblN0b3JhZ2VgIMOmwpzCicOmwpXCiMOmwpfCtsOmwpzCn8OowozCg8OlwpvCtMOlwobChcOmwrDCuMOkwrnChcOmwpzCicOmwpXCiMOjwoDCglxyXG4gKiBAcGFyYW0gW2V4cGlyZWRVbml0PSd0J10gw6jCv8KHw6bCnMKfw6bCl8K2w6nCl8K0w6XCjcKVw6TCvcKNw6/CvMKIw6nCu8KYw6jCrsKkw6/CvMKaw6jCh8Kqw6XCrsKaw6TCucKJW8Olwo3ClcOkwr3CjcOvwrzCmsOmwq/Cq8OnwqfCkl3Dr8K8wolcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBTZXNzaW9uU3RvcmFnZShcclxuICBrZXk/OiBzdHJpbmcsXHJcbiAgZXhwaXJlZEF0OiBudW1iZXIgPSAwLFxyXG4gIGV4cGlyZWRVbml0OiBFeHBpcmVkVW5pdCA9ICd0JyxcclxuKSB7XHJcbiAgcmV0dXJuIFdlYlN0b3JhZ2Uoc2Vzc2lvblN0b3JhZ2UsIGtleSwgZXhwaXJlZEF0LCBleHBpcmVkVW5pdCk7XHJcbn1cclxuIiwiaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBTdG9yYWdlVXRpbCwgRXhwaXJlZFVuaXQgfSBmcm9tICcuL3V0aWwnO1xyXG5cclxuZXhwb3J0IGNsYXNzIFN0b3JhZ2VTZXJ2aWNlIHtcclxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHN0b3JhZ2U6IFN0b3JhZ2UpIHt9XHJcblxyXG4gIGdldChrZXk6IHN0cmluZykge1xyXG4gICAgcmV0dXJuIFN0b3JhZ2VVdGlsLmdldCh0aGlzLnN0b3JhZ2UsIGtleSk7XHJcbiAgfVxyXG5cclxuICBzZXQoXHJcbiAgICBrZXk6IHN0cmluZyxcclxuICAgIHZhbHVlOiBhbnksXHJcbiAgICBleHBpcmVkQXQ6IG51bWJlciA9IDAsXHJcbiAgICBleHBpcmVkVW5pdDogRXhwaXJlZFVuaXQgPSAnZCcsXHJcbiAgKSB7XHJcbiAgICByZXR1cm4gU3RvcmFnZVV0aWwuc2V0KHRoaXMuc3RvcmFnZSwga2V5LCB2YWx1ZSwgZXhwaXJlZEF0LCBleHBpcmVkVW5pdCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDDpcKIwqDDqcKZwqTDpsKMwofDpcKuwpprZXnDr8K8wozDpcKmwoLDr8K8wppcclxuICAgKiAtIGByZW1vdmUoJ2tleScpYCDDpcKIwqDDqcKZwqQgYGtleWAgw6nClMKuXHJcbiAgICogLSBgcmVtb3ZlKC9CTWFwX1xcdysvKWAgw6bCicK5w6nCh8KPw6XCiMKgw6nCmcKkw6bCicKAw6bCnMKJIEJNYXBfIMOlwrzCgMOlwqTCtMOnwprChMOpwpTCrlxyXG4gICAqIEBwYXJhbSBrZXkgw6nClMKuw6XCkMKNw6bCiMKWw6bCrcKjw6XCiMKZw6jCocKow6jCvsK+w6XCvMKPXHJcbiAgICovXHJcbiAgcmVtb3ZlKGtleTogc3RyaW5nIHwgUmVnRXhwKSB7XHJcbiAgICBpZiAodHlwZW9mIGtleSA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgU3RvcmFnZVV0aWwucmVtb3ZlKHRoaXMuc3RvcmFnZSwga2V5KTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgbGV0IGluZGV4ID0gMDtcclxuICAgIGxldCBuZXh0ID0gU3RvcmFnZVV0aWwua2V5KHRoaXMuc3RvcmFnZSwgaW5kZXgpO1xyXG4gICAgY29uc3QgbHM6IHN0cmluZ1tdID0gW107XHJcbiAgICB3aGlsZSAobmV4dCkge1xyXG4gICAgICBpZiAoa2V5LnRlc3QobmV4dCkpIGxzLnB1c2gobmV4dCk7XHJcbiAgICAgIG5leHQgPSBTdG9yYWdlVXRpbC5rZXkodGhpcy5zdG9yYWdlLCArK2luZGV4KTtcclxuICAgIH1cclxuICAgIGxzLmZvckVhY2godiA9PiBTdG9yYWdlVXRpbC5yZW1vdmUodGhpcy5zdG9yYWdlLCB2KSk7XHJcbiAgfVxyXG5cclxuICBjbGVhcigpIHtcclxuICAgIHRoaXMuc3RvcmFnZS5jbGVhcigpO1xyXG4gIH1cclxufVxyXG5cclxuQEluamVjdGFibGUoeyBwcm92aWRlZEluOiAncm9vdCcgfSlcclxuZXhwb3J0IGNsYXNzIExvY2FsU3RvcmFnZVNlcnZpY2UgZXh0ZW5kcyBTdG9yYWdlU2VydmljZSB7XHJcbiAgY29uc3RydWN0b3IoKSB7XHJcbiAgICBzdXBlcihsb2NhbFN0b3JhZ2UpO1xyXG4gIH1cclxufVxyXG5cclxuQEluamVjdGFibGUoeyBwcm92aWRlZEluOiAncm9vdCcgfSlcclxuZXhwb3J0IGNsYXNzIFNlc3Npb25TdG9yYWdlU2VydmljZSBleHRlbmRzIFN0b3JhZ2VTZXJ2aWNlIHtcclxuICBjb25zdHJ1Y3RvcigpIHtcclxuICAgIHN1cGVyKHNlc3Npb25TdG9yYWdlKTtcclxuICB9XHJcbn1cclxuIiwiaW1wb3J0IHsgTmdNb2R1bGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuXHJcbkBOZ01vZHVsZSgpXHJcbmV4cG9ydCBjbGFzcyBBbmd1bGFyV2ViU3RvcmFnZU1vZHVsZSB7fVxyXG4iLCIvKipcbiAqIEdlbmVyYXRlZCBidW5kbGUgaW5kZXguIERvIG5vdCBlZGl0LlxuICovXG5cbmV4cG9ydCAqIGZyb20gJy4vaW5kZXgnO1xuIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBWUE7SUFBQTtLQTBFQztJQXpFUSxlQUFHLEdBQVYsVUFBVyxPQUFnQixFQUFFLEdBQVc7UUFDdEMsSUFBTSxLQUFLLEdBQUcsV0FBVyxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxJQUFJLE1BQU0sQ0FBQyxJQUFJLElBQUksQ0FBQztRQUN4RSxJQUFJLEtBQUssS0FBSyxJQUFJO1lBQUUsT0FBTyxJQUFJLENBQUM7UUFDaEMsSUFDRSxPQUFPLEtBQUssS0FBSyxRQUFRO1lBQ3pCLE9BQU8sS0FBSyxDQUFDLFFBQVEsS0FBSyxXQUFXO1lBQ3JDLEtBQUssQ0FBQyxRQUFRLEtBQUssQ0FBQztZQUNwQixDQUFDLElBQUksSUFBSSxFQUFFLEdBQUcsS0FBSyxDQUFD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